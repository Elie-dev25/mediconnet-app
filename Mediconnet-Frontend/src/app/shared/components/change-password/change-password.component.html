<div class="change-password-container">
  <div class="section-header">
    <div class="header-icon">
      <lucide-icon name="lock" [size]="24"></lucide-icon>
    </div>
    <div class="header-text">
      <h3>Changer le mot de passe</h3>
      <p>Modifiez votre mot de passe pour s√©curiser votre compte</p>
    </div>
  </div>

  <!-- Success Message -->
  <div *ngIf="successMessage" class="alert success-alert">
    <lucide-icon name="check-circle" [size]="20"></lucide-icon>
    <span>{{ successMessage }}</span>
  </div>

  <!-- Error Message -->
  <div *ngIf="errorMessage" class="alert error-alert">
    <lucide-icon name="alert-circle" [size]="20"></lucide-icon>
    <span>{{ errorMessage }}</span>
  </div>

  <form [formGroup]="changePasswordForm" (ngSubmit)="onSubmit()" class="password-form">
    <!-- Current Password -->
    <div class="form-group">
      <label for="currentPassword">
        <lucide-icon name="key" [size]="16"></lucide-icon>
        Mot de passe actuel
      </label>
      <div class="input-wrapper">
        <input
          [type]="showCurrentPassword ? 'text' : 'password'"
          id="currentPassword"
          formControlName="currentPassword"
          placeholder="Entrez votre mot de passe actuel"
          class="form-input"
          autocomplete="current-password"/>
        <button
          type="button"
          class="toggle-password"
          (click)="toggleCurrentPasswordVisibility()"
          [title]="showCurrentPassword ? 'Masquer' : 'Afficher'">
          <lucide-icon [name]="showCurrentPassword ? 'eye-off' : 'eye'" [size]="18"></lucide-icon>
        </button>
      </div>
    </div>

    <!-- New Password -->
    <div class="form-group">
      <label for="newPassword">
        <lucide-icon name="lock" [size]="16"></lucide-icon>
        Nouveau mot de passe
      </label>
      <div class="input-wrapper">
        <input
          [type]="showNewPassword ? 'text' : 'password'"
          id="newPassword"
          formControlName="newPassword"
          placeholder="Entrez votre nouveau mot de passe"
          class="form-input"
          (input)="onNewPasswordInput($event)"
          autocomplete="new-password"/>
        <button
          type="button"
          class="toggle-password"
          (click)="toggleNewPasswordVisibility()"
          [title]="showNewPassword ? 'Masquer' : 'Afficher'">
          <lucide-icon [name]="showNewPassword ? 'eye-off' : 'eye'" [size]="18"></lucide-icon>
        </button>
      </div>
      <!-- Password Strength Indicator -->
      <app-password-strength-indicator 
        [password]="newPasswordValue"
        [showCriteria]="true">
      </app-password-strength-indicator>
    </div>

    <!-- Confirm New Password -->
    <div class="form-group">
      <label for="confirmNewPassword">
        <lucide-icon name="shield-check" [size]="16"></lucide-icon>
        Confirmer le nouveau mot de passe
      </label>
      <div class="input-wrapper">
        <input
          [type]="showConfirmPassword ? 'text' : 'password'"
          id="confirmNewPassword"
          formControlName="confirmNewPassword"
          placeholder="Confirmez votre nouveau mot de passe"
          class="form-input"
          [class.is-error]="passwordMismatch()"
          autocomplete="new-password"/>
        <button
          type="button"
          class="toggle-password"
          (click)="toggleConfirmPasswordVisibility()"
          [title]="showConfirmPassword ? 'Masquer' : 'Afficher'">
          <lucide-icon [name]="showConfirmPassword ? 'eye-off' : 'eye'" [size]="18"></lucide-icon>
        </button>
      </div>
      <span *ngIf="passwordMismatch()" class="error-text">
        Les mots de passe ne correspondent pas
      </span>
    </div>

    <!-- Actions -->
    <div class="form-actions">
      <button
        type="button"
        class="btn-secondary"
        (click)="onCancel()"
        [disabled]="isLoading">
        Annuler
      </button>
      <button
        type="submit"
        class="btn-primary"
        [disabled]="changePasswordForm.invalid || isLoading || passwordMismatch()">
        <lucide-icon *ngIf="isLoading" name="loader-2" [size]="18" class="spinner"></lucide-icon>
        <lucide-icon *ngIf="!isLoading" name="check" [size]="18"></lucide-icon>
        <span>{{ isLoading ? 'Modification...' : 'Modifier le mot de passe' }}</span>
      </button>
    </div>
  </form>
</div>
