<div class="internal-form-page">
  <!-- Header -->
  <header class="internal-form-header">
    <div class="logo">
      <lucide-icon name="stethoscope" [size]="28" class="logo-icon"></lucide-icon>
      <span class="logo-text">MediConnect</span>
    </div>
    <div class="user-info" *ngIf="userName">
      <lucide-icon name="user" [size]="18"></lucide-icon>
      <span>Bienvenue, <strong>{{ userName }}</strong></span>
    </div>
  </header>

  <!-- Main Content -->
  <main class="internal-form-main">
    <div class="internal-form-card">
      <!-- Card Header -->
      <div class="internal-card-header">
        <div class="header-icon">
          <lucide-icon name="lock" [size]="32"></lucide-icon>
        </div>
        <h1>Changement de mot de passe</h1>
        <p>Pour votre sécurité, veuillez définir un nouveau mot de passe</p>
      </div>

      <!-- Error Message -->
      <div *ngIf="errorMessage" class="internal-alert alert-error">
        <lucide-icon name="alert-circle" [size]="20"></lucide-icon>
        <span>{{ errorMessage }}</span>
      </div>

      <!-- Success Message -->
      <div *ngIf="successMessage" class="internal-alert alert-success">
        <lucide-icon name="check-circle" [size]="20"></lucide-icon>
        <span>{{ successMessage }}</span>
      </div>

      <!-- Formulaire -->
      <form [formGroup]="passwordForm" (ngSubmit)="onSubmit()" class="internal-form" novalidate>
        <!-- Mot de passe actuel -->
        <div class="internal-form-group">
          <label for="currentPassword">
            <lucide-icon name="key" [size]="16"></lucide-icon>
            Mot de passe actuel <span class="required">*</span>
          </label>
          <div class="internal-input-wrapper has-toggle">
            <lucide-icon name="key" [size]="18" class="input-icon"></lucide-icon>
            <input 
              [type]="showCurrentPassword ? 'text' : 'password'"
              id="currentPassword"
              formControlName="currentPassword"
              placeholder="Votre mot de passe actuel"
              class="internal-input"
              [class.is-error]="f['currentPassword'].touched && f['currentPassword'].errors"
              autocomplete="current-password">
            <button 
              type="button" 
              class="toggle-password"
              (click)="togglePasswordVisibility('current')"
              [attr.aria-label]="showCurrentPassword ? 'Masquer le mot de passe' : 'Afficher le mot de passe'">
              <lucide-icon [name]="showCurrentPassword ? 'eye-off' : 'eye'" [size]="18"></lucide-icon>
            </button>
          </div>
          <span class="internal-error-text" *ngIf="f['currentPassword'].touched && f['currentPassword'].errors?.['required']">
            Mot de passe actuel requis
          </span>
        </div>

        <!-- Nouveau mot de passe -->
        <div class="internal-form-group">
          <label for="newPassword">
            <lucide-icon name="lock" [size]="16"></lucide-icon>
            Nouveau mot de passe <span class="required">*</span>
          </label>
          <div class="internal-input-wrapper has-toggle">
            <lucide-icon name="lock" [size]="18" class="input-icon"></lucide-icon>
            <input 
              [type]="showNewPassword ? 'text' : 'password'"
              id="newPassword"
              formControlName="newPassword"
              placeholder="Au moins 8 caractères"
              class="internal-input"
              [class.is-error]="f['newPassword'].touched && f['newPassword'].errors"
              autocomplete="new-password">
            <button 
              type="button" 
              class="toggle-password"
              (click)="togglePasswordVisibility('new')"
              [attr.aria-label]="showNewPassword ? 'Masquer le mot de passe' : 'Afficher le mot de passe'">
              <lucide-icon [name]="showNewPassword ? 'eye-off' : 'eye'" [size]="18"></lucide-icon>
            </button>
          </div>
          <span class="internal-error-text" *ngIf="f['newPassword'].touched && f['newPassword'].errors?.['required']">
            Nouveau mot de passe requis
          </span>
          <span class="internal-error-text" *ngIf="f['newPassword'].touched && f['newPassword'].errors?.['minlength']">
            Minimum 8 caractères requis
          </span>
          
          <!-- Indicateur de force du mot de passe -->
          <div class="internal-password-strength" *ngIf="f['newPassword'].value">
            <div class="strength-bar">
              <div class="strength-fill" [style.width]="passwordStrength.width" [class]="passwordStrength.class"></div>
            </div>
            <span class="strength-text" [class]="passwordStrength.class">{{ passwordStrength.label }}</span>
          </div>
        </div>

        <!-- Confirmer le mot de passe -->
        <div class="internal-form-group">
          <label for="confirmPassword">
            <lucide-icon name="shield-check" [size]="16"></lucide-icon>
            Confirmer le nouveau mot de passe <span class="required">*</span>
          </label>
          <div class="internal-input-wrapper has-toggle">
            <lucide-icon name="shield-check" [size]="18" class="input-icon"></lucide-icon>
            <input 
              [type]="showConfirmPassword ? 'text' : 'password'"
              id="confirmPassword"
              formControlName="confirmPassword"
              placeholder="Répétez le nouveau mot de passe"
              class="internal-input"
              [class.is-error]="f['confirmPassword'].touched && f['confirmPassword'].errors"
              autocomplete="new-password">
            <button 
              type="button" 
              class="toggle-password"
              (click)="togglePasswordVisibility('confirm')"
              [attr.aria-label]="showConfirmPassword ? 'Masquer le mot de passe' : 'Afficher le mot de passe'">
              <lucide-icon [name]="showConfirmPassword ? 'eye-off' : 'eye'" [size]="18"></lucide-icon>
            </button>
          </div>
          <span class="internal-error-text" *ngIf="f['confirmPassword'].touched && f['confirmPassword'].errors?.['required']">
            Confirmation requise
          </span>
          <span class="internal-error-text" *ngIf="f['confirmPassword'].touched && f['confirmPassword'].errors?.['mismatch']">
            Les mots de passe ne correspondent pas
          </span>
        </div>

        <!-- Note de sécurité -->
        <div class="internal-info-note">
          <lucide-icon name="info" [size]="18"></lucide-icon>
          <span>Votre mot de passe doit contenir au moins 8 caractères, incluant majuscules, minuscules et chiffres.</span>
        </div>

        <!-- Actions -->
        <div class="internal-form-actions">
          <button 
            type="submit" 
            class="internal-btn-success"
            [disabled]="passwordForm.invalid || isLoading">
            <lucide-icon *ngIf="isLoading" name="loader-2" [size]="18" class="spinner"></lucide-icon>
            <lucide-icon *ngIf="!isLoading" name="check" [size]="18"></lucide-icon>
            <span>{{ isLoading ? 'Modification...' : 'Modifier mon mot de passe' }}</span>
          </button>
        </div>
      </form>
    </div>
  </main>
</div>
